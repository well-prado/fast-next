---
title: Router & Validation
description: Define Fastify routes once with literal metadata and Zod schemas.
---

`@fast-next/fastify-router` + `@fast-next/fastify-zod-router` are how we capture literal metadata (`resource`, `operation`) and infer handler types.

## Example

```ts title="apps/web/src/server/routes/users.ts"
import { createRoute } from "@fast-next/fastify-router";
import type { TypedRouteHandler } from "@fast-next/fastify-zod-router";
import { z } from "zod";

const getUserSchema = {
  params: z.object({ id: z.string() }),
  response: {
    200: z.object({ id: z.string(), email: z.string().email() }),
    404: z.object({ error: z.string() }),
  },
} as const;

export const userRoutes = [
  createRoute({
    method: "GET",
    path: "/users/:id",
    resource: "users",
    operation: "get",
    schema: getUserSchema,
    handler: (async ({ params }, reply) => {
      const user = await db.user.findUnique({ where: { id: params.id } });
      if (!user) {
        reply.code(404);
        return { error: "User not found" };
      }
      return user;
    }) satisfies TypedRouteHandler<typeof getUserSchema>,
  }),
] as const;
```

## Benefits

- **Typed handlers** – `request.body`, `request.params`, and `reply` infer directly from the Zod schema.
- **Literal metadata** – `resource` + `operation` names are never widened, so `api.users.get.query()` autocompletes.
- **JSON Schema output** – `registerRoutes` uses `buildFastifySchema` under the hood so Fastify validation remains accurate.

## Composition

```ts
export async function registerRoutes(app: FastifyInstance) {
  await registerFastifyRoutes(app, [
    ...userRoutes,
    ...projectRoutes,
  ]);
}
```

Need a prefix (`/v1`)? Pass `{ prefix: "/v1" }` to `registerFastifyRoutes` instead of duplicating paths.

## Tips

- **Colocate feature files** – `features/<name>/schemas.ts`, `service.ts`, `routes.ts` keeps things discoverable.
- **Map response codes** – Even when the shape matches, declare `200` vs `404` separately so the server caller understands possible outcomes.
- **Use `route()` for uncommon verbs** – `builder.route("OPTIONS", ...)` is available when you need it.
- **Inspect schemas** – `buildFastifySchema` returns the converted JSON Schema if you want to feed Swagger or tooling.

Follow these patterns and every route automatically lights up in the server client, browser hooks, and docs.
