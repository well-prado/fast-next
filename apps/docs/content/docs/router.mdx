---
title: Router & Validation
description: Define Fastify routes once with literal metadata and Zod schemas.
---

`@fast-next/fastify-router` + `@fast-next/fastify-zod-router` are how we capture literal metadata (`resource`, `operation`) and infer handler types.

## Example

```ts title="apps/fast-next-playground/src/server/http/routes/system/health.ts"
import { createRoute } from "@fast-next/fastify-router";
import type { TypedRouteHandler } from "@fast-next/fastify-zod-router";
import { z } from "zod";

const getUserSchema = {
  params: z.object({ id: z.string() }),
  response: {
    200: z.object({ id: z.string(), email: z.string().email() }),
    404: z.object({ error: z.string() }),
  },
} as const;

export const systemRoutes = [
  createRoute({
    method: "GET",
    path: "/health",
    resource: "system",
    operation: "health",
    schema: getUserSchema,
    handler: (async () => ({ status: "ok" as const })) satisfies TypedRouteHandler<typeof getUserSchema>,
  }),
] as const;
```

## Benefits

- **Typed handlers** – `request.body`, `request.params`, and `reply` infer directly from the Zod schema.
- **Literal metadata** – `resource` + `operation` names are never widened, so `api.users.get.query()` autocompletes.
- **Zod-first validation** – Fastify runs your Zod schemas directly via `fastify-type-provider-zod`, so you get the same validation on HTTP requests as you do inside server callers.

## Composition

```ts title="src/server/http/routes/index.ts"
export const serverRoutes = [
  ...systemRoutes,
  ...projectRoutes,
] as const;

export async function registerHttpRoutes(app: FastifyInstance) {
  await registerFastifyRoutes(app, serverRoutes);
}
```

Need a prefix (`/v1`)? Pass `{ prefix: "/v1" }` to `registerFastifyRoutes` when calling `registerHttpRoutes`.

## Tips

- **Colocate feature files** – `src/server/http/routes/<name>/{schemas,service,routes}.ts` keeps things discoverable.
- **Map response codes** – Even when the shape matches, declare `200` vs `404` separately so the server caller understands possible outcomes.
- **Use `route()` for uncommon verbs** – `builder.route("OPTIONS", ...)` is available when you need it.
- **Inspect schemas** – Since the Zod schemas remain intact, you can reuse them for Swagger/OpenAPI tooling or share them with other runtimes without an extra conversion step.

Follow these patterns and every route automatically lights up in the server client, browser hooks, and docs.
