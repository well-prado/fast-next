---
title: Feature Guide
description: Build the projects slice end-to-end and reuse it across server + browser clients.
---

This walkthrough mirrors the `projects` feature shipped inside `apps/web`.

## 1. Define Routes

```ts title="apps/web/src/server/routes/projects.ts"
import { createRoute, type FastifyRouteDefinition } from "@fast-next/fastify-router";
import type { TypedRouteHandler } from "@fast-next/fastify-zod-router";
import { z } from "zod";

const projectSchema = z.object({
  id: z.string(),
  name: z.string(),
  status: z.enum(["draft", "active", "archived"]),
});

type Project = z.infer<typeof projectSchema>;
let projects: Project[] = [
  { id: "p1", name: "DX Overhaul", status: "active" },
  { id: "p2", name: "Edge API Gateway", status: "draft" },
];

export const projectRoutes = [
  createRoute({
    method: "GET",
    path: "/projects",
    resource: "projects",
    operation: "list",
    schema: {
      response: z.object({ items: z.array(projectSchema) }),
    },
    handler: (async () => ({ items: projects })) satisfies TypedRouteHandler<{ response: ReturnType<typeof z.object> }>,
  }),
  createRoute({
    method: "POST",
    path: "/projects",
    resource: "projects",
    operation: "create",
    schema: {
      body: z.object({
        name: z.string().min(3),
        status: projectSchema.shape.status.default("draft"),
      }),
      response: { 201: projectSchema },
    },
    handler: (async (request, reply) => {
      const next = {
        id: `p${projects.length + 1}`,
        name: request.body.name,
        status: request.body.status,
      } as const;
      projects = [...projects, next];
      reply.code(201);
      return next;
    }) satisfies TypedRouteHandler<typeof projectSchema>,
  }),
] as const satisfies readonly FastifyRouteDefinition[];
```

## 2. Register Routes

```ts title="apps/web/src/server/routes/index.ts"
export const serverRoutes = [
  // health route ...
  ...projectRoutes,
] as const;

export async function registerRoutes(app: FastifyInstance) {
  await registerFastifyRoutes(app, serverRoutes);
}
```

## 3. Generate API Helpers

```ts title="apps/web/src/server/api.ts"
export const serverCaller = createServerCaller(builtRouter);
export const api = createServerClient(serverRoutes, serverCaller);
export const queryClient = new FastifyQueryClient();
```

- `api.projects.list.query()` runs the Fastify handler directly (perfect for Server Components, jobs, tests).
- `queryClient.fetchQuery()` batches/memoizes server-side fetches.

## 4. Server Component Usage

```ts title="apps/web/app/page.tsx"
const featuredUser = await api.users.get.query({ params: { id: "1" } });
const { data: projectList } = await api.projects.list.query();
```

## 5. Browser Client Hooks

```ts title="apps/web/src/client/api.ts"
export const api = createBrowserClient(serverRoutes, {
  baseUrl: "/api",
  queryClient: new FastifyQueryClient(),
});
```

```tsx title="apps/web/src/components/projects-client-panel.tsx"
const query = api.projects.list.useQuery();
const mutation = api.projects.create.useMutation({
  invalidate: { resource: "projects" },
});
```

## 6. Validate End-to-End

```bash
pnpm --filter web dev
curl http://localhost:3000/api/projects
pnpm --filter web check-types
```

Repeat this pattern for each feature: colocated schemas/services/routes, single registration point, and automatic availability across server + browser clients.
