---
title: Feature Guide
description: Build the projects slice end-to-end and reuse it across server + browser clients.
---

This walkthrough mirrors the `projects` slice shipped inside `apps/fast-next-playground`.

## 1. Define shared schema + service

```ts title="apps/fast-next-playground/src/server/http/routes/projects/store.ts"
import { z } from "zod";

export const projectSchema = z.object({
  id: z.string(),
  name: z.string(),
  status: z.enum(["draft", "active", "archived"]),
});

export type Project = z.infer<typeof projectSchema>;

const projects: Project[] = [
  { id: "p1", name: "DX Overhaul", status: "active" },
  { id: "p2", name: "Edge API Gateway", status: "draft" },
];

export function listProjects() {
  return projects;
}

export function addProject(project: Project) {
  projects.push(project);
  return project;
}
```

## 2. Create route files per verb

```ts title=".../projects/list-projects.ts"
import { createRoute } from "@fast-next/fastify-router";
import type { TypedRouteHandler } from "@fast-next/fastify-zod-router";
import { z } from "zod";

import { listProjects, projectSchema } from "./store";

const schema = {
  response: z.object({ items: z.array(projectSchema) }),
} as const;

export const listProjectsRoute = createRoute({
  method: "GET",
  path: "/projects",
  resource: "projects",
  operation: "list",
  schema,
  handler: (async () => ({ items: listProjects() })) satisfies TypedRouteHandler<typeof schema>,
});
```

```ts title=".../projects/create-project.ts"
import { createRoute } from "@fast-next/fastify-router";
import type { TypedRouteHandler } from "@fast-next/fastify-zod-router";
import { z } from "zod";

import { addProject, projectSchema } from "./store";

const schema = {
  body: z.object({
    name: z.string().min(3),
    status: projectSchema.shape.status.optional().default("draft"),
  }),
  response: {
    201: projectSchema,
  },
} as const;

export const createProjectRoute = createRoute({
  method: "POST",
  path: "/projects",
  resource: "projects",
  operation: "create",
  schema,
  handler: (async (request, reply) => {
    const newProject = addProject({
      id: `p${Date.now().toString().slice(-4)}`,
      name: request.body.name,
      status: request.body.status ?? "draft",
    });
    reply.code(201);
    return newProject;
  }) satisfies TypedRouteHandler<typeof schema>,
});
```

```ts title=".../projects/index.ts"
import { createProjectRoute } from "./create-project";
import { listProjectsRoute } from "./list-projects";

export const projectRoutes = [listProjectsRoute, createProjectRoute] as const;
```

## 3. Register routes with Fastify

```ts title="src/server/http/routes/index.ts"
import { systemRoutes } from "./system";
import { projectRoutes } from "./projects";

export const serverRoutes = [
  ...systemRoutes,
  ...projectRoutes,
] as const;

export async function registerHttpRoutes(app: FastifyInstance) {
  await registerFastifyRoutes(app, serverRoutes);
}
```

## 4. Generate server + browser clients

```ts title="src/server/api.ts"
const builtRouter = {
  routes: serverRoutes,
  register: registerHttpRoutes,
} satisfies BuiltRouter<typeof serverRoutes>;

export const serverCaller = createServerCaller(builtRouter);
const typedServerRoutes = serverRoutes as readonly FastifyRouteDefinition[];
const typedServerCaller = serverCaller as FastifyCaller<typeof typedServerRoutes>;
export const api = createServerClient(typedServerRoutes, typedServerCaller);
export const queryClient = new FastifyQueryClient();
```

```ts title="src/client/api.ts"
import { serverRoutes } from "@/server/http/routes";

export const api = createBrowserClient(serverRoutes, {
  baseUrl: "/api",
  queryClient: new FastifyQueryClient(),
});
```

## 5. Server Component usage

```tsx title="app/demo/page.tsx"
const [healthResult, projectsResult] = await Promise.all([
  api.system.health.request().catch(() => null),
  api.projects.list.request().catch(() => null),
]);
```

## 6. Browser hooks

```tsx title="components/projects-client-panel.tsx"
const query = api.projects.list.useQuery({ refetchOnWindowFocus: false });
const mutation = api.projects.create.useMutation({
  invalidate: { resource: "projects" },
});
```

## 7. Validate end-to-end

```bash
pnpm --filter fast-next-playground dev
curl http://localhost:3000/api/projects
pnpm --filter fast-next-playground check-types
```

Repeat this pattern for each feature: colocated schemas/services/routes, single registration point, and automatic availability across server + browser clients.
