# CLI Reference

Use the `create-fast-next` CLI to scaffold files and keep feature routes consistent across projects.

## Installation

While the package lives inside this monorepo, you can execute it via any package manager:

```bash
npx create-fast-next init .
pnpm dlx create-fast-next init .
yarn create fast-next init .
bunx create-fast-next init .
```

Once it’s published to npm, the same commands work globally. During development you can point `pnpm dlx` at the local workspace: `pnpm dlx --package=./packages/create-fast-next create-fast-next init .`.

## Commands

### `init`

```
pnpm dlx create-fast-next init [projectDir] \
  --app app \
  --server src/server \
  --api app/api/[...fastify]
```

- Creates the catch-all API route that forwards requests to Fastify.
- Sets up `src/server/fastify-app.ts`, `src/server/routes/index.ts`, and `src/server/api.ts`.
- Adds placeholder markers (`FAST_NEXT_ROUTE_IMPORTS` / `FAST_NEXT_ROUTE_SPREAD`) so future features can be appended automatically.
- Drops a starter health-check route so `/api/health` responds immediately.
- Prompts for directories when flags aren’t provided (disable with `--yes`).
- Optionally updates `package.json` and installs all required dependencies when `--install auto|pnpm|npm|yarn|bun` is supplied (or when you accept the prompt).

Options:

| Flag | Description | Default |
| --- | --- | --- |
| `--app <path>` | Location of your Next.js `app` directory. | `app` |
| `--server <path>` | Directory that should hold `fastify-app.ts`, `routes`, etc. | `src/server` |
| `--api <path>` | Relative path to the catch-all API route folder. | `<app>/api/[...fastify]` |
| `--force` | Overwrite files if they already exist. | `false` |
| `--install <pm>` | Install deps with `pnpm`, `npm`, `yarn`, `bun`, `auto`, or `skip`. | Prompt in TTY / `skip` in CI |
| `--yes` | Skip interactive prompts (use defaults). | `false` |
| `--with-queue` | Include BullMQ queue scaffolding (services, queues, workers). | Prompted |

When `--with-queue` is enabled, the CLI generates:

- `src/server/services/queue.service.ts` – central BullMQ registry with retry/backoff defaults.
- `src/server/queues/email.queue.ts` – example producer helper.
- `src/server/workers/email.worker.ts` + `workers/index.ts` – ready-to-run worker bootstrap.

It also adds `bullmq`/`ioredis` to your dependencies and reminds you to configure `REDIS_HOST`, `REDIS_PORT`, and `REDIS_PASSWORD`.

### `feature`

```
pnpm dlx create-fast-next feature projects --server src/server --dir .
```

- Generates a full feature folder: `schemas.ts`, `service.ts`, `routes.ts`, and a stub `routes.test.ts`.
- Route templates include both `GET /<resource>` and `POST /<resource>` handlers plus in-memory services you can replace.
- Updates `src/server/routes/index.ts` by inserting the necessary import and spreading the new routes into the master array (using the scaffold markers added during `init`).

Options:

| Flag | Description | Default |
| --- | --- | --- |
| `--dir <path>` | Project root where the server directory lives. | `.` |
| `--server <path>` | Path to the server folder relative to `dir`. | `src/server` |
| `--force` | Overwrite the feature file if it already exists. | `false` |

> Tip: run `pnpm dlx create-fast-next feature analytics` as many times as you like—your `server/routes/index.ts` file will stay tidy thanks to the FAST_NEXT markers.

## Manual usage inside the monorepo

During development (before publishing) you can invoke the CLI directly:

```
pnpm dlx --package=./packages/create-fast-next create-fast-next init .
```

or

```
node packages/create-fast-next/bin/create-fast-next.mjs feature audit --server apps/web/src/server
```

The generated files match the conventions documented throughout this guide, so the server caller, browser client, and docs will continue to apply without additional tweaks.
